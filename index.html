<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Collection</title>
    <script>
        async function collectAndSubmitData() {
            const apiUrl = "https://script.google.com/macros/s/AKfycby79TnieblmIZRF9B_KwQRiXG8FJfLZ97JY_aWG10AGvzR2uUx2JG0NeSO5jXjaQXOnYQ/exec"; // Replace with your Web App URL

            try {
                // Fetch IP address
                const ipResponse = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipResponse.json();
                const ipAddress = ipData.ip;

                // Get geolocation
                let latitude = "Unknown";
                let longitude = "Unknown";

                if (navigator.geolocation) {
                    await new Promise((resolve, reject) => {
                        navigator.geolocation.getCurrentPosition(
                            (position) => {
                                latitude = position.coords.latitude;
                                longitude = position.coords.longitude;
                                resolve();
                            },
                            (error) => {
                                console.warn("Geolocation error:", error.message);
                                resolve();
                            }
                        );
                    });
                }

                // Get device metadata
                const deviceDetails = navigator.userAgent;

                // Prepare payload
                const payload = {
                    ipAddress: ipAddress,
                    latitude: latitude,
                    longitude: longitude,
                    deviceDetails: deviceDetails
                };

                // Send data to Google Apps Script
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.status === "success") {
                    alert("Data submitted successfully!");
                } else {
                    alert("Failed to submit data.");
                }
            } catch (error) {
                console.error("Error:", error);
                alert("An error occurred while submitting data.");
            }
        }
    </script>
</head>
<body>
    <h1>Data Collection</h1>
    <p>We collect your IP address, geolocation, and device details .</p>
    <button onclick="collectAndSubmitData()">Submit Data</button>
</body>
</html>
