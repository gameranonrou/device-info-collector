<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Record User Data</title>
    <script>
        async function submitData() {
            const apiUrl = "https://script.google.com/macros/s/AKfycbwEdtEv9W7SsNaRj35my2QW6pH7LSeCyQ1KPLJg7YGABNxwh9wZS0KFApqxHpC1Y1XT/exec"; // Replace with your Web App URL

            try {
                // Collect input values
                const name = document.getElementById('name').value;
                const phoneNumber = document.getElementById('phoneNumber').value;

                // Fetch geolocation
                let latitude = "Unknown";
                let longitude = "Unknown";

                if (navigator.geolocation) {
                    await new Promise((resolve, reject) => {
                        navigator.geolocation.getCurrentPosition(
                            (position) => {
                                latitude = position.coords.latitude;
                                longitude = position.coords.longitude;
                                resolve();
                            },
                            (error) => {
                                console.warn("Geolocation error:", error.message);
                                resolve(); // Resolve even if geolocation fails
                            }
                        );
                    });
                }

                // Get device metadata and IP address
                const deviceDetails = navigator.userAgent;
                const ipResponse = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipResponse.json();
                const ipAddress = ipData.ip;

                // Prepare payload
                const payload = {
                    name: name,
                    phoneNumber: phoneNumber,
                    latitude: latitude,
                    longitude: longitude,
                    deviceDetails: deviceDetails,
                    ipAddress: ipAddress
                };

                console.log("Sending payload:", payload);

                // Send data to Google Apps Script
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.status === "success") {
                    alert("Data submitted successfully!");
                } else {
                    alert("Failed to submit data: " + JSON.stringify(result));
                }
            } catch (error) {
                console.error("Error occurred:", error);
                alert("An error occurred. Check the console for details.");
            }
        }
    </script>
</head>
<body>
    <h1>Record User Data</h1>
    <form onsubmit="event.preventDefault(); submitData();">
        <label for="name">Name:</label><br>
        <input type="text" id="name" name="name" required><br><br>

        <label for="phoneNumber">Phone Number:</label><br>
        <input type="tel" id="phoneNumber" name="phoneNumber" required><br><br>

        <button type="submit">Submit</button>
    </form>
</body>
</html>
